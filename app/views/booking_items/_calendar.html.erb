<%= turbo_frame_tag "calendar" do %>
  
  <!-- date selector section -->

  <%= form_with(url: "/booking_items", method: :get) do |form| %>
    <%= turbo_frame_tag "calendar_current_date" do %>
      <%= form.date_field :start_date, value: current_date  %>
    <% end %>
    <%= form.submit 'get date' %>
  <% end %>
  
  <%= form_with(url: "/booking_items", method: :get) do |form| %>
    <%= turbo_frame_tag "calendar_previous_week_date" do %>
      <%= form.date_field :start_date, value: (current_date - 7.days), class: "visually-hidden" %>
    <% end %>
    <%= form.submit 'previous week' %>
  <% end %>
  
  <%= form_with(url: "/booking_items", method: :get) do |form| %>
    <%= turbo_frame_tag "calendar_next_week_date" do %>
      <%= form.date_field :start_date, value: (current_date + 7.days), class: "visually-hidden" %>
    <% end %>
    <%= form.submit 'next week' %>
  <% end %>
  
  <hr>
  
  <!-- date selector end -->
  
  <!-- calendar section -->
  
  <% 
    dates_array = (current_date..(current_date + 7)).to_a 
    
    room_list = [
      "Durian Runtuh",
      "Rahsiah",
      "Senjja",
      "Evensong",
      "Sasterawan",
      "Khemah"
    ]
  
  %>
  
  <table id="calendar-table" class="table table-bordered">
    <thead>
      <th scope="col">Room</th>
      
      <% dates_array.map{|x| x.strftime("%a %d")}.each do |calendar_day_string| %>
        <th><%= calendar_day_string %></th>
      <% end %>
    </thead>
    <tbody>
      <% room_list.each do |room_name| %>
        <tr id="#{room_name}_row">
          <td><%= turbo_frame_tag "#{room_name}_name" do %><%= room_name %><% end %></td>
            <% dates_array.each do |calendar_day| %>
              <td>
                <%= turbo_frame_tag "#{room_name}_#{calendar_day.strftime("%a")}_occupancy" do %>
                  <% if booking_items.where("inventories.name = ?", room_name).where("start_date <= ?", calendar_day).where("end_date > ?", calendar_day).present? %>
                    Yes
                  <% end %>
                <% end %>
              </td>
            <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
  
  <!-- calendar section end -->
  
  
<% end %>